function MapLocation(e,o,t){var n=this;n.latLng={lat:e,lng:o},n.address=t}function initMap(){map=new google.maps.Map(document.getElementById("neighborhood-map"),{center:searchedCenter().latLng,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT},zoom:13}),(autocompleteAddress=new google.maps.places.Autocomplete(document.getElementById("autocomplete-address"),{types:["geocode"]})).addListener("place_changed",function(){var e=autocompleteAddress.getPlace();searchedCenter(new MapLocation(e.geometry.location.lat(),e.geometry.location.lng()))}),ko.applyBindings(new ViewModel(map))}var map,autocompleteAddress,googleAddress=new MapLocation(37.4224936,-122.0877586,"1600 Amphitheatre Parkway, Mountain View, CA 94043, United States"),foursquareAPI="https://api.foursquare.com/v2/venues/explore?v=20170627&client_id=5FGAX5XB03JLW5CIP10XDGS1RBBKXRP5NU2CRG4SUSXVN42G&client_secret=UGUH4QH3A5RFUPXGVDCIFN2JIYZGQ4IZYEXSWFHT4UJA0TS2&query=food&limit=20&ll=",searchedCenter=ko.observable(googleAddress),ViewModel=function(e){function o(){s.markerList().forEach(function(e){google.maps.geometry.poly.containsLocation(e.position,g)?e.setMap(map):e.setMap(null)})}function t(e,o){console.log(e),e.response.groups[0].items.forEach(function(e,t){var i=a(e.venue.location),r=new google.maps.Marker({position:i,title:e.venue.name,animation:google.maps.Animation.DROP,id:t,address:e.venue.location.formattedAddress});s.markerList.push(r),r.addListener("click",function(){n(this,o)})}),s.showAllMarkers()}function n(e,o){if(o.marker!==e){o.setContent(""),o.marker=e,o.addListener("closeclick",function(){o.marker=null});(new google.maps.StreetViewService).getPanoramaByLocation(e.position,50,function(t,n){if(n===google.maps.StreetViewStatus.OK){var a=t.location.latLng,i=google.maps.geometry.spherical.computeHeading(a,e.position);o.setContent("<div>"+e.title+"</div><div>"+e.address+"</div><div>"+e.position.lat()+","+e.position.lng()+'</div><div id="pano"></div>');var r={position:a,pov:{heading:i,pitch:30}};new google.maps.StreetViewPanorama(document.getElementById("pano"),r)}else o.setContent("<div>"+e.title+"</div><div>"+e.address+"</div><div>"+e.position.lat()+","+e.position.lng()+"</div><div>No Street View Found</div>")}),o.open(map,e)}}function a(e){var o={lat:e.lat,lng:e.lng};return d.geocode({address:e.formattedAddress.join(" ")},function(e,t){t===google.maps.GeocoderStatus.OK?o=e[0].geometry.location:console.log("unable to find geocoder")}),o}function i(){s.markerList().forEach(function(e){e.setMap(null)})}function r(e){alert(e)}var s=this,l=new google.maps.InfoWindow,d=new google.maps.Geocoder,c=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,drawingModes:[google.maps.drawing.OverlayType.POLYGON]}}),g=null;s.map=e,s.markerList=ko.observableArray(),s.selectedMarker=ko.observable(),s.searchHandler=function(){map.panTo(searchedCenter().latLng),s.searchRestaurants()},s.getInitialGeoLocation=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){searchedCenter(new MapLocation(e.coords.latitude,e.coords.longitude))}),s.searchHandler()},s.searchRestaurants=function(){$.ajax({url:foursquareAPI+searchedCenter().latLng.lat+","+searchedCenter().latLng.lng,context:document.body}).done(function(e){200===e.meta.code?(s.markerList.removeAll(),t(e,l)):r("No Venue found.")}).fail(function(e){s.handleErrors(e)})},s.selectMarker=function(e){i(),s.selectedMarker(e),e.setMap(map)},c.addListener("overlaycomplete",function(e){g&&(g.setMap(null),i()),c.setDrawingMode(null),(g=e.overlay).setEditable(!0),o(),g.getPath().addListener("set_at",o),g.getPath().addListener("insert_at",o)}),s.toggleDrawing=function(){c.map?(c.setMap(null),null!==g&&g.setMap(null)):c.setMap(map)},s.showAllMarkers=function(){var e=new google.maps.LatLngBounds;s.markerList().forEach(function(o){o.setMap(s.map),e.extend(o.position)}),s.map.setCenter(e.getCenter())},s.getInitialGeoLocation()};