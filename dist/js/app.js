function MapLocation(e,o){this.latLng={lat:e,lng:o}}function initMap(){map=new google.maps.Map(document.getElementById("neighborhood-map"),{center:searchedCenter().latLng,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT},zoom:13}),(autocompleteAddress=new google.maps.places.Autocomplete(document.getElementById("autocomplete-address"),{types:["geocode"]})).addListener("place_changed",function(){var e=autocompleteAddress.getPlace();searchedCenter(new MapLocation(e.geometry.location.lat(),e.geometry.location.lng()))}),ko.applyBindings(new ViewModel(map))}var map,autocompleteAddress,googleAddress=new MapLocation(37.4224936,-122.0877586),foursquareAPI="https://api.foursquare.com/v2/venues/explore?v=20170627&client_id=5FGAX5XB03JLW5CIP10XDGS1RBBKXRP5NU2CRG4SUSXVN42G&client_secret=UGUH4QH3A5RFUPXGVDCIFN2JIYZGQ4IZYEXSWFHT4UJA0TS2&query=food&limit=10&ll=",searchedCenter=ko.observable(googleAddress),ViewModel=function(e){function o(e,o){console.log(e),e.response.groups[0].items.forEach(function(e,n){var a=new MapLocation(e.venue.location.lat,e.venue.location.lng),r=new google.maps.Marker({position:a.latLng,title:e.venue.name,animation:google.maps.Animation.DROP,id:n,address:e.venue.location.formattedAddress,latLng:a.latLng});i.markerList().push(r),r.addListener("click",function(){t(this,o)})}),n()}function t(e,o){if(o.marker!==e){o.setContent(""),o.marker=e,o.addListener("closeclick",function(){o.marker=null});(new google.maps.StreetViewService).getPanoramaByLocation(e.position,50,function(t,n){if(n===google.maps.StreetViewStatus.OK){var a=t.location.latLng,i=google.maps.geometry.spherical.computeHeading(a,e.position);o.setContent("<div>"+e.title+"</div><div>"+e.address+"</div><div>"+e.latLng.lat+","+e.latLng.lng+'</div><div id="pano"></div>');var r={position:a,pov:{heading:i,pitch:30}};new google.maps.StreetViewPanorama(document.getElementById("pano"),r)}else o.setContent("<div>"+e.title+"</div><div>No Street View Found</div>")}),o.open(map,e)}}function n(){var e=new google.maps.LatLngBounds;i.markerList().forEach(function(o){o.setMap(i.map),e.extend(o.position)}),i.map.setCenter(e.getCenter())}function a(e){alert(e)}var i=this,r=new google.maps.InfoWindow;i.map=e,i.markerList=ko.observableArray(),i.searchHandler=function(){map.panTo(searchedCenter().latLng),i.searchRestaurants()},i.getInitialGeoLocation=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){searchedCenter(new MapLocation(e.coords.latitude,e.coords.longitude))}),i.searchHandler()},i.searchRestaurants=function(){$.ajax({url:foursquareAPI+searchedCenter().latLng.lat+","+searchedCenter().latLng.lng,context:document.body}).done(function(e){200===e.meta.code?(i.markerList.removeAll(),o(e,r)):a("No Venue found.")}).fail(function(e){i.handleErrors(e)})},i.getInitialGeoLocation()};