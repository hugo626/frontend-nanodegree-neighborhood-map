function MapLocation(e,o,t){var n=this;n.latLng={lat:e,lng:o},n.address=t}function initMap(){map=new google.maps.Map(document.getElementById("neighborhood-map"),{center:searchedCenter().latLng,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT},zoom:13}),(autocompleteAddress=new google.maps.places.Autocomplete(document.getElementById("autocomplete-address"),{types:["geocode"]})).addListener("place_changed",function(){var e=autocompleteAddress.getPlace();searchedCenter(new MapLocation(e.geometry.location.lat(),e.geometry.location.lng()))}),ko.applyBindings(new ViewModel(map))}var map,autocompleteAddress,googleAddress=new MapLocation(37.4224936,-122.0877586,"1600 Amphitheatre Parkway, Mountain View, CA 94043, United States"),foursquareAPI="https://api.foursquare.com/v2/venues/explore?v=20170627&client_id=5FGAX5XB03JLW5CIP10XDGS1RBBKXRP5NU2CRG4SUSXVN42G&client_secret=UGUH4QH3A5RFUPXGVDCIFN2JIYZGQ4IZYEXSWFHT4UJA0TS2&query=food&limit=20&ll=",searchedCenter=ko.observable(googleAddress),ViewModel=function(e){function o(){d.markerList().forEach(function(e){google.maps.geometry.poly.containsLocation(e.position,m)?e.setMap(map):e.setMap(null)})}function t(e,o){console.log(e),e.response.groups[0].items.forEach(function(e,t){var n=r(e.venue.location),s=new google.maps.Marker({position:n,title:e.venue.name,animation:google.maps.Animation.DROP,id:t,icon:u,address:e.venue.location.formattedAddress,categories:e.venue.categories[0].name,rating:e.venue.rating});d.markerList.push(s),s.addListener("click",function(){a(this,o),i(this)}),s.addListener("mouseover",function(){this.setIcon(v)}),s.addListener("mouseout",function(){this.setIcon(u)})}),d.showAllMarkers()}function n(e){return new google.maps.MarkerImage("http://chart.googleapis.com/chart?chst=d_map_pin_icon&chld=restaurant|"+e)}function a(e,o){if(o.marker!==e){o.setContent(""),o.marker=e,o.addListener("closeclick",function(){o.marker=null,e.setAnimation(null)});(new google.maps.StreetViewService).getPanoramaByLocation(e.position,50,function(t,n){var a='<div class="map-inforwindow"><div class= "infor-text"><div class="infor-text-title title">'+e.title+'</div><div class="map-inforwindow infor-text-rating"><div class="label">Rating:</div><div>'+e.rating+'</div></div><div class="infor-text-address"><div class="label">Address"</div><div><div>'+e.address[0]+"</div><div>"+e.address[1]+"</div><div>"+e.address[2]+'</div></div></div><div class="infor-text-categories"><div class="label">Categories:</div><div>'+e.categories+"</div></div></div>";if(n===google.maps.StreetViewStatus.OK){var i=t.location.latLng,r=google.maps.geometry.spherical.computeHeading(i,e.position);o.setContent(a+'<div id="pano"></div></div>');var s={position:i,pov:{heading:r,pitch:30}};new google.maps.StreetViewPanorama(document.getElementById("pano"),s)}else o.setContent(a+'<div id="pano">No Street View Found</div><div>')}),o.open(map,e)}}function i(e){d.markerList().forEach(function(o){o===e?null!==o.getAnimation()?o.setAnimation(null):o.setAnimation(google.maps.Animation.BOUNCE):o.setAnimation(null)})}function r(e){var o={lat:e.lat,lng:e.lng};return g.geocode({address:e.formattedAddress.join(" ")},function(e,t){t===google.maps.GeocoderStatus.OK?o=e[0].geometry.location:console.log("unable to find geocoder")}),o}function s(){d.markerList().forEach(function(e){e.setMap(null)})}function l(e){alert(e)}var d=this,c=new google.maps.InfoWindow,g=new google.maps.Geocoder,p=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_LEFT,drawingModes:[google.maps.drawing.OverlayType.POLYGON]}}),m=null,u=n("0091ff"),v=n("dd6666");d.map=e,d.markerList=ko.observableArray(),d.selectedMarker=ko.observable(),d.searchHandler=function(){map.panTo(searchedCenter().latLng),d.searchRestaurants()},d.getInitialGeoLocation=function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){searchedCenter(new MapLocation(e.coords.latitude,e.coords.longitude))}),d.searchHandler()},d.searchRestaurants=function(){$.ajax({url:foursquareAPI+searchedCenter().latLng.lat+","+searchedCenter().latLng.lng,context:document.body}).done(function(e){200===e.meta.code?(d.markerList.removeAll(),t(e,c)):l("No Venue found.")}).fail(function(e){d.handleErrors(e)})},d.selectMarker=function(e){s(),d.selectedMarker(e),e.setMap(map),i(e),a(e,c)},p.addListener("overlaycomplete",function(e){m&&(m.setMap(null),s()),p.setDrawingMode(null),(m=e.overlay).setEditable(!0),o(),m.getPath().addListener("set_at",o),m.getPath().addListener("insert_at",o)}),d.toggleDrawing=function(){p.map?(p.setMap(null),null!==m&&m.setMap(null)):p.setMap(map)},d.showAllMarkers=function(){var e=new google.maps.LatLngBounds;d.markerList().forEach(function(o){o.setMap(d.map),e.extend(o.position)}),d.map.setCenter(e.getCenter()),d.selectedMarker(null)},d.getInitialGeoLocation()};